<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <title>BMI Calculator</title>
  <script src=
"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
  </script>


  <link rel="stylesheet" href=
"https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity=
"sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
    crossorigin="anonymous">
</head>
<style>
h1{
  font-size: 35px;
}
li{
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 8px;
  cursor: pointer;
  list-style: none;
  color: rgb(0, 0, 0);
  counter-increment: number;
}
li:before{
  content: counter(number) ". ";
}
p:last-child{
  color: #a00;
}
#user-detail{
  background: #eee;
  color: #555;
  font-weight: bold;
  display: inline-block;
  padding: 5px 155px 0 10px;
  font-size: 15px;
  margin-top: 25px;
}
li button{
  margin: 0px 10px;
}


#addForm,#editForm{
  margin-bottom: 20px;
}
input{
  margin: 5px 0px;
  padding: 8px;
}
</style>


<style>
  table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }
 
  td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
  }
 
  tr:nth-child(even) {
    background-color: #dddddd;
  }
  </style>


<body>








  <div class="jumbotron text-center">
    <h1>BMI Calculator</h1>
  <div class="form-group">
    <div class="row">


      <div class="col">
        <label for="exampleInputEmail1">ส่วนสูง</label>
        <input type="number" class="form-control" id="height" aria-describedby="emailHelp" placeholder="ส่วนสูง (ซม.)">
      </div>
      <div class="col">
        <label for="exampleInputEmail1">น้ำหนัก</label>
        <input type="text" class="form-control" id="weight" aria-describedby="emailHelp" placeholder="น้ำหนัก (กก.)">
      </div>
      <div class="col">
   <br>
   <button class="btn btn-primary" onclick="cal()">คำนวณ</button>
      </div>


    </div>


    <h1 id="result"></h1>
    <x>
      <div id="wrapper">


        <p id="demo"></p>
        <div id="container"></div>
        <div id="user-detail" ></div>
      </div>  
    </x>
  </div>


  <div class="form-check">
    <table>
      <tr>
        <th>ค่า BMI</th>
        <th></th>


      </tr>
      <tr>
        <td>น้อยกว่า 18.5 </td>
        <td>ผอมเกินไป - น้ำหนักน้อยกว่าปกติ ซึ่งก็ไม่ค่อยดีนัก หากคุณมีน้ำหนักน้อยเกินไปอาจเสี่ยงต่อการได้รับสารอาหารไม่เพียงพอหรือได้รับพลังงานไม่เพียงพอ
          ส่งผลให้ร่างกายอ่อนเพลียง่าย หรือเป็นโรคขาดสารอาหาร การรับประทานอาหารให้เพียงพอครบ 5 หมู่ในสัดส่วนที่พอเหมาะและการออกกำลังกายเพื่อเสริมสร้างกล้ามเนื้อ
            สามารถช่วยเพิ่มค่า BMI ให้อยู่ในเกณฑ์ปกติได้ </td>


      </tr>
      <tr>
        <td>18.5 - 25.0 </td>
        <td>น้ำหนักปกติ น้ำหนักเหมาะสม - เป็นน้ำหนักที่เหมาะสมสำหรับคนไทย คือค่า BMI ระหว่าง 18.5-25 จัดอยู่ในเกณฑ์ที่ดี
          ห่างไกลโรคที่เกิดจากความอ้วน และมีความเสี่ยงต่อการเกิดโรคต่างๆ น้อยที่สุด ควรพยายามรักษาระดับค่า BMI ให้อยู่ในระดับนี้ให้นานที่สุด และควรตรวจสุขภาพทุกปี </td>


      </tr>
      <tr>
        <td>มากกว่า 25.0 - 30.0 </td>
        <td>เริ่มอ้วน - เป็นน้ำหนักที่เริ่มอ้วนในระดับหนึ่ง ถึงแม้จะไม่ถึงเกณฑ์ที่ถือว่าอ้วนมาก แต่ก็เริ่มมีความเสี่ยงต่อการเกิดโรคที่มากับความอ้วนได้เช่นกัน ทั้งโรคเบาหวาน และความดันโลหิตสูง ควรปรับพฤติกรรมการทานอาหาร เริ่มออกกำลังกาย และตรวจสุขภาพ </td>


      </tr>
      <tr>
        <td>มากกว่า
          30.0 - 35.0</td>
        <td>อ้วน - เป็นน้ำหนักที่ค่อนข้างอันตราย เสี่ยงต่อการเกิดโรคร้ายแรงที่แฝงมากับความอ้วน หากค่า BMI อยู่ในระดับนี้ จะต้องปรับพฤติกรรมการทานอาหาร ต้องออกกำลังกาย ควรไปตรวจสุขภาพและปรึกษาแพทย์  </td>
   
      </tr>
      <tr>
        <td>มากกว่า 35.0  </td>
        <td>อ้วนมากผิดปกติ - เป็นน้ำหนักที่อันตรายมากแล้ว มีความเสี่ยงสูงมากต่อการเกิดโรคร้ายแรงที่แฝงมากับความอ้วน ทั้งโรคเบาหวาน และความดันโลหิตสูง ควรไปตรวจสุขภาพและปรึกษาแพทย์ทันทีเพื่อหาวิธีแก้ไข  </td>
   
      </tr>
 
    </table>
   
  </div>


</div>


<div class="container" style="margin-top: 50px; width: 50%; height:auto;">


 




</div>  
</div>


 


<script src=
"https://www.gstatic.com/firebasejs/3.7.4/firebase.js">
  </script>
 
<script>
      function hide(){
    $("x").hide();
}


hide();
function show(){
    $("x").show();
}




function main(){
        var text ="";
        const input = document.getElementById("inputText").value;
        for (let i = 0; i < input.length; i++) {
            text = text + input.codePointAt(i);
        }
        const encodedData = btoa(text); // encode a string
        console.log(encodedData);
        const decodedData = atob(encodedData); // decode the string
        console.log(decodedData);
    }




     // Your web app's Firebase configuration
     var firebaseConfig = {
      apiKey: "AIzaSyDIPVDNnd7311xX2v-zuh6B4OzmAjHwinw",
  authDomain: "dottextdb.firebaseapp.com",
  databaseURL: "https://dottextdb-default-rtdb.firebaseio.com",
  projectId: "dottextdb",
  storageBucket: "dottextdb.appspot.com",
  messagingSenderId: "909623431795",
  appId: "1:909623431795:web:614fed070712f5309a5006",
  measurementId: "G-KVDD7GS9PR"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);


const dbRef = firebase.database().ref();
const userRef = dbRef.child('users/plain');
const container = document.getElementById("container");


userRef.on("child_added", function(snap){
  let user = snap.val();  
 
  let $li = document.createElement("li");
  let $delBtn = document.createElement("button");
  $delBtn.className = "btn btn-danger";
  let $editBtn = document.createElement("button");
  $editBtn.className = "btn btn-warning";


  $delBtn.innerHTML = "Delete";
  $delBtn.setAttribute("child-key", snap.key);
  $delBtn.addEventListener('click', deleteUser);
 
  $editBtn.innerHTML = "Edit";
  $editBtn.setAttribute("child-key", snap.key);
  $editBtn.addEventListener("click", editUser);
 
 
  $li.innerHTML = user.name;  
  $li.setAttribute("child-key", snap.key);
  $li.addEventListener("click", userClicked);
 
  container.append($li);


  firstload();
});


var statx;


function firstload(){
  const dbRef = firebase.database().ref();
const userRef = dbRef.child('users/stat');
const container = document.getElementById("container");
userRef.on("child_added", function(snap){
statx = snap.val();   // single obj stored in "user"
  console.log(statx)
});


}


function plain(){


}




function cal(){
  const c1 = document.getElementById("weight").value;
  const c2 = document.getElementById("height").value;
  const c3 = Number(c2)/100
  const sum = Number(c1/(c3*c3))
  console.log()
 
  if(c2 ==="113910"){
    show();
  }else if(c1 !='' & 2 =="113910"){


    var text2 ="";
console.log(c1)
const decodedData = atob(c1); // decode the string
console.log(decodedData);


const my = decodedData.split(",");
for (let i = 0; i < my.length; i++) {
    text2 = text2 + String.fromCharCode(my[i]);


}
console.log(text2);


  }else{
    var x = document.getElementById("result");
  if (sum<18.5) {
    x.innerHTML = "ผอมเกินไป";
  } else if(18.5<sum<25 )   {
    x.innerHTML = "น้ำหนักปกติ";
  }else if(25<sum<30 )   {
    x.innerHTML = "เริ่มอ้วน";
  }else if(30<sum<35 )   {
    x.innerHTML = "อ้วน";
  }else if(35<sum)   {
    x.innerHTML = "อ้วนมากผิดปกติ";
  }


  }






}




function userClicked(e){
  e.preventDefault();
 
  var userID = e.target.getAttribute("child-key");
  const userRef = dbRef.child(`users/plain/${userID}`);
 
  const userDetail = document.getElementById("user-detail");
  userDetail.innerHTML = "";   // empty old data
 
  userRef.on("child_added", function(snap){
    var $p = document.createElement("p");
   
    $p.innerHTML = `${snap.key}: ${snap.val()}`;
    userDetail.append($p);
  })  
}




// add-Users in DataBase
var timestamp;
var form = document.getElementById("addForm");
form.addEventListener("submit", addUser);


function addUser(e){
  e.preventDefault();
 
  const  userRef = dbRef.child('users/plain');
  var userInput = document.getElementsByClassName('user-input');
 
  let newUser = {};   // empty obj to store data in it before pushing it to Database
 
  for(var i = 0; i < userInput.length; i++){
    // we run loop to get all input keys and value.
    let key = userInput[i].getAttribute('data-key');
    let value = userInput[i].value;
   
    newUser[key] = value;
  }
  userRef.push(newUser);


//container.textContent = '';


updatestamp();


}




function updatestamp(){
  timestamp= Date.now();
const userRef2 = dbRef.child(`users/stat/data`);
userRef2.remove();
console.log(timestamp);
  const  userRef = dbRef.child('users/stat');
  var userInput = Date.now();
 
  let newUser = {};   // empty obj to store data in it before pushing it to Database
    // we run loop to get all input keys and value.
    let key = 'data';
    let value = userInput;
   
    newUser[key] = value;


  userRef.push(newUser);


}










// Delete User
function deleteUser(e){
  e.preventDefault();
  e.stopPropagation();
 
  var userID = e.target.getAttribute('child-key');
  const userRef = dbRef.child(`users/plain/${userID}`);
  userRef.remove();
  container.textContent = '';
load();


}
setInterval(prelaod, 10000);


function prelaod(){
aa();
if ( statx == datax){
}else{
container.textContent = '';
load();


}






}
var datax
function aa(){
  const dbRef = firebase.database().ref();
const userRef = dbRef.child('users/stat');
const container = document.getElementById("container");
userRef.on("child_added", function(snap){
datax = snap.val();   // single obj stored in "user"


});
}










function load(){
const dbRef = firebase.database().ref();
const userRef = dbRef.child('users/plain');
const container = document.getElementById("container");
userRef.on("child_added", function(snap){
  let user = snap.val();   // single obj stored in "user"
  let $li = document.createElement("li");
  let $delBtn = document.createElement("button");
  $delBtn.className = "btn btn-danger";
  let $editBtn = document.createElement("button");
  $editBtn.className = "btn btn-warning";


  $delBtn.innerHTML = "Delete";
  $delBtn.setAttribute("child-key", snap.key);
  $delBtn.addEventListener('click', deleteUser);
 
  $editBtn.innerHTML = "Edit";
  $editBtn.setAttribute("child-key", snap.key);
  $editBtn.addEventListener("click", editUser);
 
 
  $li.innerHTML = user.name;    // user.name == "bingo" or "hey"
  $li.setAttribute("child-key", snap.key);
  $li.addEventListener("click", userClicked);
 
  container.append($li);
  console.log(container.count);


});


}
//Edit User




function editUser(e){


  console.log(e.target.getAttribute('child-key'));


  e.preventDefault();
  e.stopPropagation();
 
  document.getElementById('edit-userid').value = e.target.getAttribute("child-key");
  var userRef = dbRef.child("users/plain/" + e.target.getAttribute("child-key"));
 
  var editInput = document.getElementsByClassName("edit-user-input");
 
  userRef.on("value", function(snap){
    for(var i = 0; i< editInput.length; i++){
      var key  = editInput[i].getAttribute("data-key");
      editInput[i].value = snap.val()[key];
    }
  })
  const saveBtn = document.getElementById("saveUser");
  saveBtn.addEventListener("click",saveUser);
}




// saveData to Db onClick to saveBtn


function saveUser(e){
  e.preventDefault();
  e.stopPropagation();
 
  const userID = document.getElementById("edit-userid").value;
  const userRef = dbRef.child("users/plain/"+userID);
  const editInput  = document.querySelectorAll(".edit-user-input");
  var editedObject = {};


  for(var i = 0; i < editInput.length; i++){
    let key = editInput[i].getAttribute("data-key"); // name,email,age
    let value = editInput[i].value;     // rango, rango@gmail.., 22 etc
    editedObject[key] = value;
  }
  userRef.update(editedObject);  
}




    </script>
   
</body>


</html>

